<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>设备列表</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="css/font.css">
    <link rel="stylesheet" href="css/xadmin.css">
    <link rel="stylesheet" type="text/css" href="css/devicelist-manage.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/xadmin.js"></script>
    <script type="text/javascript" src="js/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="js/area.js"></script>
    <script src="./node_modules/jquery/dist/jquery.min.js"></script>
    <script src="./layer/layer.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
</div>
<div class="x-body">
    <div class="layui-row">
        <form class="layui-form layui-col-md12 x-so layui-form-pane">
            <input class="layui-input" placeholder="输入设备码" name="cate_name_1" >
            <input class="layui-input" placeholder="输入设备物主" name="cate_name_2" >
			<input class="layui-input" placeholder="请输入地址" name="cate_name_3" >
            <div class="layui-input-inline">
                <select name="cateid">
                    <option>全部</option>
                    <option>已审核</option>
                    <option>未审核</option>
                </select>
            </div>
            <input class="layui-input" placeholder="创建时间" name="start" id="start">
            <input class="layui-input" placeholder="" name="end" id="end">
            <button class="layui-btn search-btn"  lay-submit="" lay-filter="sreach">查询</button>
            <!-- <a class="layui-btn addList"  onclick="addDeviceList()" href="javascript:void(0)">添加设备</a> -->
        </form>
    </div>
<!-- addDevice start -->
<div class="addDevice" style="display: none;">
<ul>
    <li><font>设备编码</font><input type="text" class="layui-input" name="" placeholder="输入设备编码"></li>
    <div style="clear: both;"></div>
    <li><font>设备物主</font><input type="text" class="layui-input" name="" placeholder="输入设备物主"></li>
    <div style="clear: both;"></div>
    <li>
        <font>设备地址</font>
    <div class="input-select-inline">
        <select id="s_province" name="s_province"></select>  
        <select id="s_city" name="s_city" ></select>  
        <select id="s_county" name="s_county"></select>
<script class="resources library" src="js/area.js" type="text/javascript"></script>
<script type="text/javascript">_init_area();</script>
    <div id="show"></div>
    </div>
    <script type="text/javascript">
var Gid  = document.getElementById ;
var showArea = function(){
    Gid('show').innerHTML = "<h3>省" + Gid('s_province').value + " - 市" +    
    Gid('s_city').value + " - 县/区" + 
    Gid('s_county').value + "</h3>"
                            }
</script>
    </li>
    <div style="clear: both;"></div>
    <li><font>详细地址</font><input type="text" name="" class="layui-input" placeholder="输入设备详细地址"></li>
    <div style="clear: both;"></div>
    <li><font>线下管理员</font><input type="text" name="" class="layui-input" placeholder="线下管理员"></li>
    <div style="clear: both;"></div>
    <li><font>管理员电话</font><input type="text" name="" class="layui-input" placeholder="管理员电话"></li>
    <div style="clear: both;"></div>
    <li><button class="layui-btn hold" type="submit">保存</button></li>
</ul>
</div>
<!-- addDevice end -->

    <xblock>
        <button class="layui-btn addList">添加设备</button>
        <!-- <a class="layui-btn addList" href="javascript:void(0)" onclick="addDeviceList()">添加设备</a> -->
    </xblock>

    <table class="layui-table table">
        <thead>
        <tr>
            <th>
                <div class="layui-unselect header layui-form-checkbox" lay-skin="primary"><i class="layui-icon">&#xe605;</i></div>
                全选
            </th>
            <th>设备编码</th>
            <th>设备物主</th>
            <th>审核状态</th>
            <th>设备地址</th>
            <th>添加设备时间</th>
            <th>线下管理员</th>
            <th>联系方式</th>
            <th>操作</th>
        </thead>
        <tbody>

        </tbody>
    </table>
   <div class="page">
        <div id="page-link"></div>
      </div>

</div>
<script>
    layui.use('laydate', function(){
        var laydate = layui.laydate;



        //执行一个laydate实例
        laydate.render({
            elem: '#start' //指定元素
        });

        //执行一个laydate实例
        laydate.render({
            elem: '#end' //指定元素
        });
    });

    /*用户-停用*/
    function member_stop(obj,id){
        layer.confirm('确认要停用吗？',function(index){

            if($(obj).attr('title')=='启用'){

                //发异步把用户状态进行更改
                $(obj).attr('title','停用')
                $(obj).find('i').html('&#xe62f;');

                $(obj).parents("tr").find(".td-status").find('span').addClass('layui-btn-disabled').html('已停用');
                layer.msg('已停用!',{icon: 5,time:1000});

            }else{
                $(obj).attr('title','启用')
                $(obj).find('i').html('&#xe601;');

                $(obj).parents("tr").find(".td-status").find('span').removeClass('layui-btn-disabled').html('已启用');
                layer.msg('已启用!',{icon: 5,time:1000});
            }

        });
    }

    /*用户-删除*/
    function member_del(obj,id){
        layer.confirm('确认要删除吗？',function(index){
            //发异步删除数据
            $(obj).parents("tr").remove();
            layer.msg('已删除!',{icon:1,time:1000});
        });
    }



    function delAll (argument) {

        var data = tableCheck.getData();

        layer.confirm('确认要删除吗？'+data,function(index){
            //捉到所有被选中的，发异步进行删除
            layer.msg('删除成功', {icon: 1});
            $(".layui-form-checked").not('.header').parents('tr').remove();
        });
    }
</script>

<script type="text/javascript">
$('.addList').on('click',function(){
    layer.open({
        type:1,
        title:'添加设备',
        area:['40%','70%'],
        shadeClose:true,
        shad:[0.8,'#855'],
        content:$(".addDevice")
    })
})
$('.update').on('click',function () {
    layer.open({
        type:1,
        title:'修改设备信息',
        area:['40%','70%'],
        shadeClose:true,
        shad:[0.8,'#855'],
        content:$(".addDevice")
    })
})

//数据渲染
function userGroup(res){
  var html = "";
  var NoData = `<td colspan="9" style="height: 20rem;text-align: center;color:#ff0000;line-height: 20rem;font-size:2.5rem;">暂无数据！</td>`;
  $.each(res, function (i,e) {
    html +=`        <tr>
            <td>
                <div class="layui-unselect layui-form-checkbox" data-id="2" lay-skin="primary"><i class="layui-icon">&#xe605;</i></div>
            </td>
            <td>${e.printerCode}</td>
            <td>${e.sysUser.realName}</td>
           <td>${e.status?'通过':'没通过'}</td>
            <td>${e.address}</td>
            <td>${e.createTime}</td>
            <td>${e.managerName}</td>
            <td>${e.managerPhone}</td>
            <td>
                <button class="layui-btn">禁用</button>
                <button class="layui-btn updateUser">修改</button>
                <a href="./sys/check-owner.html" class="layui-btn showUser">查看</a>
                <a class="layui-btn" href="./sys/add-owner.html">添加管理员</a>
            </td>
        </tr>`;

  });
  if(res.length>0){
    $(".layui-table tbody").html(html);
  }else{
    $(".layui-table tbody").html(NoData);
  }
}

$.ajax({
	url:"http://123.206.42.162:10002/zx/pm/list",
	type:"GET",
	data:{
		page:1,
		pageSize:10,
		//设备物主的id 后面请改成动态
		//sysUserId:2
	},
	async:false,
	success:function(res){
		//console.log(res);
		userGroup(res.data.content)
	}
})

/*
*模糊函数
*/
$(".search-btn").click(function(){
	$.ajax({
		url:"http://123.206.42.162:10002/zx/pm/list",
		type:"GET",
		data:{
			//pageNum:1,
			//pageSize:10,
			printerCode:$("*[name = 'cate_name_1']").val(),
			//nickname:$("*[name = 'cate_name_2']").val(),
			address:$("*[name = 'cate_name_3']").val(),
			//startTime:$("*[name = 'start']").val(),
			//endTime:$("*[name = 'end']").val()
		},
		async:false,
		success:function(res){
		console.log(res);
			userGroup(res.data.content)
		}
	
	})
	
	
	return false;

})

/**
*添加管理员

* addUser").click(function () {
*	alert();
*  var addUserName = $("#addUser").val();
*  var addUserStatus = $("#addUserStatus").val();
*  $.ajax({
*    url:"http://123.206.42.162:10002/sys/insertRoll",
*    method:"POST",
*    data:{
*        name:addUserName,
*        perms:addUserStatus,
*        remark:"''"
*    },
*    success:function (res) {
*      console.log(res);
*      console.log("添加成功");
*    }
*  })
* })
*/

/**
 * 修改用户
* $(".updateUser").click(function () {
*  var userId = parseInt($("#amend-user-id").text());
*  var userName = $("#amend-user").val();
*  var userPerms = $("#amend-status").val();
*  console.log(userId,userName,userPerms);
*  $.ajax({
*    method:"POST",
*    url:"http://123.206.42.162:10002/sys/updateRole",
*    data:{
*      id:userId,
*      name:userName,
*      perms:userPerms
*    },
*    async:false,
*    success:function (res) {
*      console.log("修改成功");
*    }
*  })
* })
 */

/**
 * 查看信息
 */
$(".showUser").click(function () {
	alert();
  $.ajax({
    method:"POST",
    url:"http://123.206.42.162:10002/zx/pm/info/"+ 1,
    async:false,
    success:function (res) {
      console.log("修改成功");
    }
  })
})
</script>
</body>

</html>