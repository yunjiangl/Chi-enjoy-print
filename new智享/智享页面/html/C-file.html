<!DOCTYPE html>
<html>
  
  <head>
    <meta charset="UTF-8">
    <title>C类文件</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="css/font.css">
    <link rel="stylesheet" href="css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/xadmin.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  
  <body>
      <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
        <i class="layui-icon" style="line-height:30px">ဂ</i></a>
    </div>
    <div class="x-body">
      <div class="layui-row">
        <form class="layui-form layui-col-md12 x-so layui-form-pane">
		<input class="layui-input" placeholder="线上管理员" name="userName" >
		<input class="layui-input" placeholder="输入标题" name="fileName" >
		<input class="layui-input" placeholder="创建时间" name="start" id="start">至
        <input class="layui-input" placeholder="创建时间" name="end" id="end">
        <button class="layui-btn"  lay-submit="" lay-filter="sreach" id="layui-btn-search">查询</button>
        </form>
      </div>
      <xblock>
        <button class="layui-btn layui-btn-danger" onclick="delAll()"><i class="layui-icon"></i>批量删除</button>
        <span class="x-right" style="line-height:40px"></span>
      </xblock>
      <table class="layui-table">
        <thead>
          <tr>
            <th>
              <div class="layui-unselect header layui-form-checkbox" lay-skin="primary"><i class="layui-icon">&#xe605;</i></div>
              全选
            </th>
            <th>ID</th>
            <th>标题</th>
            <th>线上管理员</th>
			<th>客户</th>
            <th>操作</th>
        </thead>
        <tbody>
          <!--<tr>
            <td>
              <div class="layui-unselect layui-form-checkbox" lay-skin="primary" data-id='2'><i class="layui-icon">&#xe605;</i></div>
            </td>
            <td>1</td>
            <td>国务院关于建立城镇职工基本医疗保险制度的决定</td>
            <td>张亮亮</td>
            <td>
              <button class="layui-btn">删除</button>
              <button class="layui-btn">查看</button>
            </td>
          </tr>-->
        </tbody>
      </table>
      <div class="page">
        <div id="page-link">
          <!--<a class="prev" href="">&lt;&lt;</a>
          <a class="num" href="">1</a>
          <span class="current">2</span>
          <a class="num" href="">3</a>
          <a class="num" href="">489</a>
          <a class="next" href="">&gt;&gt;</a>-->
        </div>
      </div>

    </div>
    <script>
      layui.use('laydate', function(){
        var laydate = layui.laydate;

        
        
        //执行一个laydate实例
        laydate.render({
          elem: '#start' //指定元素
        });

        //执行一个laydate实例
        laydate.render({
          elem: '#end' //指定元素
        });
      });

       /*用户-停用*/
      function member_stop(obj,id){
          layer.confirm('确认要停用吗？',function(index){

              if($(obj).attr('title')=='启用'){

                //发异步把用户状态进行更改
                $(obj).attr('title','停用')
                $(obj).find('i').html('&#xe62f;');

                $(obj).parents("tr").find(".td-status").find('span').addClass('layui-btn-disabled').html('已停用');
                layer.msg('已停用!',{icon: 5,time:1000});

              }else{
                $(obj).attr('title','启用')
                $(obj).find('i').html('&#xe601;');

                $(obj).parents("tr").find(".td-status").find('span').removeClass('layui-btn-disabled').html('已启用');
                layer.msg('已启用!',{icon: 5,time:1000});
              }
              
          });
      }

      /*用户-删除*/
      function member_del(obj,id){
          layer.confirm('确认要删除吗？',function(index){
              //发异步删除数据
              $(obj).parents("tr").remove();
              layer.msg('已删除!',{icon:1,time:1000});
          });
      }



      function delAll (argument) {

        var data = tableCheck.getData();
  
        layer.confirm('确认要删除吗？'+data,function(index){
            //捉到所有被选中的，发异步进行删除
            layer.msg('删除成功', {icon: 1});
            $(".layui-form-checked").not('.header').parents('tr').remove();
        });
      }
    </script>
    <script>var _hmt = _hmt || []; (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?b393d153aeb26b46e9431fabaf0f6190";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();</script>
  </body>
<script>
layui.use('laydate', function(){
        var laydate = layui.laydate;



        //执行一个laydate实例
        laydate.render({
            elem: '#start' //指定元素
        });

        //执行一个laydate实例
        laydate.render({
            elem: '#end' //指定元素
        });
    });

/**
 * 进入页面时加载数据
 */
//全局变量
//var totalElementsAll = 0;//数据总数
  var startPageName = 0;//开始
  var pageSizeSetting = 10 ;//每页显示多少条
  var startPageNum = 1; //初始页第1页
  var type  = "c文件分类";
//ajax请求后台数据
  getUserGroupAllData();


/**
 * 页面渲染函数
 */
function userGroup(res){
  var html = "";
  var NoData = `<td colspan="6" style="height: 20rem;text-align: center;color:#ff0000;line-height: 20rem;font-size:2.5rem;">暂无数据！</td>`;
  $.each(res, function (i,e) {
    html +=`<tr>
            <td>
              <div class="layui-unselect layui-form-checkbox" lay-skin="primary" data-id='2'><i class="layui-icon">&#xe605;</i></div>
            </td>
            <td>${e.id}</td>
            <td>${e.fileName}</td>
			<td>${e.lawyer.nickname}</td>
            <td>${e.zxUser.nickname}</td>
            <td>
              <button class="layui-btn" value="${e.id}" id="look">删除</button>
              <button class="layui-btn" value="${e.id}" id="delete">查看</button>
            </td>
          </tr>`;

  });
  if(res.length>0){
    $(".layui-table tbody").html(html);
  }else{
    $(".layui-table tbody").html(NoData);
  }
}

/**
 * 分页开始
 */
toPage();


function getUserGroupAllData(){
  $.ajax({
    url:"http://123.206.42.162:10002/zx/cde/list",
    type:"POST",
    data:{
      pageNum:startPageNum,
      pageSize:pageSizeSetting,
	  typeString:type
    },
    async:false,
    success:function (res,status) {
      userGroup(res.data.content);
	  console.log(res.data.content);
      totalElementsAll = res.data.totalElements;
	   $(".x-right").html("共有数据："+totalElementsAll+"条");

    }
  })
}
//console.log(totalElementsAll);
function toPage(){
  layui.use('laypage', function() {
    var laypage = layui.laypage;
    //调用分页
    laypage.render({
      elem: 'page-link'
      ,count: totalElementsAll //从后台得到总条数
      ,skip: true
      ,jump: function(obj, first){
        startPageNum = obj.curr;//点击时获得当前第几页
        startPageName = (obj.curr-1)*pageSizeSetting;
        if(!first){ //一定要加此判断，否则初始时会无限刷新
          getUserGroupAllData();//一定要把翻页的ajax请求放到这里，不然会请求两次。
        }
      }
    });

  });
};

    $("#layui-btn-search").click(function () {
    startPageNum = 1;
	pageSizeSetting =10;
    toPage();
    $(".page-link").hide();
	var userName =  $("input[name = 'userName']").val();
    var fileName = $("input[name = 'fileName']").val();
	var start = $("#start").val();
	var end = $("#end").val();
    $.ajax({
      url:"http://123.206.42.162:10002/zx/cde/list",
      method:"POST",
      data:{
        page:startPageNum,
        pageSize:pageSizeSetting,
		fileName: fileName,
		userName:userName,
		startTime:start,
		endTime:end,
		typeString:type
      },
//      async:false,
      success:function (res) {
        var dataContent=res.data.content;
		console.log(dataContent);
        userGroup(dataContent);
      },
    })
  });
  
  $("#delete").click(function(){
     var id = $(this).val();
	 var ids = parseInt(id);
	 $.ajax({
      url:"http://123.206.42.162:10002/zx/cde/sys/deleteUserById",
      method:"GET",
      data:{
        ids:ids
      },
//      async:false,
      success:function (res) {
        getUserGroupAllData();
		toPage();
      },
    })
  })
  
</script>
</html>